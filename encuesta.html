<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Votación - Encuesta</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-vote-yea"></i> Sistema de Votación
            </a>
            <div class="navbar-text text-white">
                <span id="estadoEncuesta">Acceso requerido</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Pantalla 1: Login -->
        <div id="pantallaLogin" class="screen active">
            <div class="row justify-content-center">
                <div class="col-lg-6 col-md-8">
                    <div class="form-container">
                        <div class="form-header text-center">
                            <h2><i class="fas fa-lock me-2"></i>Acceso a la Encuesta</h2>
                            <p class="text-muted">Ingrese su código de acceso para comenzar</p>
                        </div>
                        
                        <div id="loginAlert" class="alert alert-danger" style="display: none;"></div>
                        
                        <div class="form-group mb-4">
                            <label for="inputCodigo" class="form-label">
                                <i class="fas fa-key me-2"></i>Código de Acceso
                            </label>
                            <input type="text" id="inputCodigo" class="form-control form-control-lg text-uppercase" 
                                   placeholder="Ej: ENC12345" maxlength="8" autocomplete="off">
                            <div class="form-text">Ingrese el código que recibió en el registro</div>
                        </div>
                        
                        <div class="form-group mb-4">
                            <label for="inputEmail" class="form-label">
                                <i class="fas fa-envelope me-2"></i>Email de verificación
                            </label>
                            <input type="email" id="inputEmail" class="form-control" 
                                   placeholder="ejemplo@email.com" autocomplete="off">
                            <div class="form-text">Email registrado en el sistema</div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <small>
                                Si no tiene un código, primero debe registrarse en la página de registro.
                                <a href="registro.html" class="alert-link">Ir al registro</a>
                            </small>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary btn-lg" onclick="validarAcceso()">
                                <i class="fas fa-sign-in-alt me-2"></i> Ingresar a la Encuesta
                            </button>
                            <button class="btn btn-outline-secondary" onclick="window.location.href='registro.html'">
                                <i class="fas fa-user-plus me-2"></i> Ir al Registro
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pantalla 2: Bienvenida -->
        <div id="pantallaBienvenida" class="screen" style="display: none;">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="form-container">
                        <div class="form-header text-center">
                            <h2><i class="fas fa-user-check me-2 text-success"></i>¡Bienvenido/a!</h2>
                            <p class="text-muted" id="saludoUsuario">Cargando información...</p>
                        </div>
                        
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-info-circle me-2"></i>Información de acceso</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Propietario:</strong> <span id="infoPropNombre"></span></p>
                                        <p><strong>Departamento:</strong> <span id="infoPropDepto"></span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Código:</strong> <span id="infoPropCodigo"></span></p>
                                        <p><strong>Fecha:</strong> <span id="infoPropFecha"></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-success">
                            <i class="fas fa-clipboard-check me-2"></i>
                            <strong>Instrucciones para la encuesta:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Responda todas las preguntas obligatorias (marcadas con *)</li>
                                <li>Puede navegar entre preguntas con los botones Anterior/Siguiente</li>
                                <li>Revise sus respuestas antes de enviar</li>
                                <li>El envío es definitivo y no podrá modificar después</li>
                            </ul>
                        </div>
                        
                        <div class="text-center mt-4">
                            <h5><i class="fas fa-poll me-2"></i>Resumen de la encuesta</h5>
                            <div class="row mt-3">
                                <div class="col-md-4">
                                    <div class="stat-card">
                                        <div class="stat-value" id="totalPreguntas">0</div>
                                        <div class="stat-label">Preguntas</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="stat-card">
                                        <div class="stat-value" id="tiempoEstimado">0</div>
                                        <div class="stat-label">Minutos estimados</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="stat-card">
                                        <div class="stat-value" id="preguntasObligatorias">0</div>
                                        <div class="stat-label">Obligatorias</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 mt-5">
                            <button class="btn btn-primary btn-lg" onclick="iniciarEncuesta()">
                                <i class="fas fa-play me-2"></i> Comenzar Encuesta
                            </button>
                            <button class="btn btn-outline-secondary" onclick="volverALogin()">
                                <i class="fas fa-sign-out-alt me-2"></i> Salir
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pantalla 3: Encuesta -->
        <div id="pantallaEncuesta" class="screen" style="display: none;">
            <div class="row">
                <div class="col-lg-3 d-none d-lg-block">
                    <!-- Panel de navegación -->
                    <div class="sticky-top" style="top: 20px;">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-list me-2"></i>Navegación
                            </div>
                            <div class="card-body">
                                <div class="progress mb-3">
                                    <div class="progress-bar" id="progressBar" role="progressbar" style="width: 0%"></div>
                                </div>
                                <div class="text-center mb-3">
                                    <small id="progressText">Pregunta 0 de 0</small>
                                </div>
                                <div id="preguntasList" class="list-group list-group-flush">
                                    <!-- Preguntas se cargan dinámicamente -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-3">
                            <div class="card-header">
                                <i class="fas fa-clock me-2"></i>Tiempo
                            </div>
                            <div class="card-body text-center">
                                <h4 id="tiempoTranscurrido">00:00</h4>
                                <small>Tiempo en la encuesta</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-9">
                    <!-- Pregunta actual -->
                    <div class="question-card">
                        <div class="question-header d-flex justify-content-between align-items-center mb-3">
                            <span class="question-number" id="numeroPregunta">Pregunta 0</span>
                            <span class="question-category badge bg-secondary" id="categoriaPregunta">Categoría</span>
                        </div>
                        
                        <div class="question-text mb-4">
                            <span id="textoPregunta">Cargando pregunta...</span>
                            <span class="obligatoria" id="indicadorObligatoria" style="display: none;"> *</span>
                        </div>
                        
                        <!-- Contenedor de opciones -->
                        <div id="opcionesContainer" class="mb-4">
                            <!-- Opciones se cargan dinámicamente -->
                        </div>
                        
                        <!-- Textarea para respuestas abiertas -->
                        <div id="textoContainer" style="display: none;">
                            <textarea id="textoRespuesta" class="form-control" rows="4" 
                                      placeholder="Escriba su respuesta aquí..."></textarea>
                        </div>
                        
                        <!-- Navegación -->
                        <div class="nav-buttons d-flex justify-content-between mt-4">
                            <button class="btn btn-secondary" id="btnAnterior" onclick="preguntaAnterior()" disabled>
                                <i class="fas fa-arrow-left me-2"></i> Anterior
                            </button>
                            <button class="btn btn-primary" id="btnSiguiente" onclick="preguntaSiguiente()">
                                Siguiente <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Panel móvil -->
                    <div class="d-block d-lg-none mt-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="progress mb-3">
                                    <div class="progress-bar" id="progressBarMobile" role="progressbar" style="width: 0%"></div>
                                </div>
                                <div class="text-center">
                                    <small id="progressTextMobile">Pregunta 0 de 0</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pantalla 4: Resumen -->
        <div id="pantallaResumen" class="screen" style="display: none;">
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <div class="form-container">
                        <div class="form-header text-center">
                            <h2><i class="fas fa-clipboard-check me-2"></i>Resumen de Respuestas</h2>
                            <p class="text-muted">Revise sus respuestas antes de enviar definitivamente</p>
                        </div>
                        
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Atención:</strong> Una vez enviada la encuesta, no podrá modificar sus respuestas.
                        </div>
                        
                        <div id="resumenContainer" class="mb-4">
                            <!-- Respuestas se cargan dinámicamente -->
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <button class="btn btn-secondary" onclick="volverAEncuesta()">
                                <i class="fas fa-edit me-2"></i> Volver a editar
                            </button>
                            <button class="btn btn-success btn-lg" onclick="enviarEncuesta()">
                                <i class="fas fa-paper-plane me-2"></i> Enviar Encuesta
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pantalla 5: Confirmación -->
        <div id="pantallaConfirmacion" class="screen" style="display: none;">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="form-container text-center">
                        <div class="mb-4">
                            <i class="fas fa-check-circle fa-5x text-success"></i>
                        </div>
                        
                        <h2 class="mb-3">¡Encuesta Completada!</h2>
                        <p class="lead mb-4">Gracias por participar en nuestra encuesta. Su opinión es muy importante para nosotros.</p>
                        
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-receipt me-2"></i>Comprobante de participación</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Propietario:</strong> <span id="confPropNombre"></span></p>
                                        <p><strong>Fecha:</strong> <span id="confFecha"></span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Preguntas:</strong> <span id="confTotalPreguntas"></span></p>
                                        <p><strong>Hora:</strong> <span id="confHora"></span></p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <small class="text-muted">ID de transacción: <code id="confTransaccionId"></code></small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-envelope me-2"></i>
                            Se ha registrado su participación exitosamente. Los resultados serán publicados próximamente.
                        </div>
                        
                        <div class="d-grid gap-2 col-lg-6 mx-auto mt-4">
                            <button class="btn btn-primary" onclick="volverAlInicio()">
                                <i class="fas fa-home me-2"></i> Volver al Inicio
                            </button>
                            <button class="btn btn-outline-secondary" onclick="verResultados()">
                                <i class="fas fa-chart-bar me-2"></i> Ver Resultados
                            </button>
                        </div>
                    </div>
                    
                    <!-- Estadísticas -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <i class="fas fa-chart-line me-2"></i>Estadísticas de participación
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="stat-value" id="estadisticaTotal">0</div>
                                    <div class="stat-label">Total propietarios</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-value text-success" id="estadisticaCompletados">0</div>
                                    <div class="stat-label">Han votado</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-value text-warning" id="estadisticaPendientes">0</div>
                                    <div class="stat-label">Pendientes</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-value text-info" id="estadisticaPorcentaje">0%</div>
                                    <div class="stat-label">Participación</div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <canvas id="participacionChart" height="100"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Sistema de Votación</h5>
                    <p>Plataforma para comunidades de propietarios</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p>&copy; 2024 Sistema de Votación. Todos los derechos reservados.</p>
                    <p>Versión 2.0 - GitHub Pages</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/database.js"></script>
    <script src="js/seguridad.js"></script>
    <script src="js/encuesta.js"></script>
    <script src="js/charts.js"></script>
</body>
</html>